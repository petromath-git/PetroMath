doctype html
html(lang='en')
    head
        meta(charset='UTF-8')
        meta(name='viewport', content='width=device-width, initial-scale=1.0')
        title Bill #{bill.bill_no} - Print
        style.
            /* A5 paper size: 148mm x 210mm */
            @page {
                size: A5;
                margin: 4mm;
            }
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Courier New', monospace;
                font-size: 10px;
                line-height: 1.2;
                width: 140mm; /* A5 width minus margins */
                margin: 0 auto;
                background: white;
                color: black;
            }
            
            /* Container for each copy */
            .copy-container {
                width: 100%;
                height: 101mm; /* Half of A5 height minus margins */
                padding: 2mm;
                border-bottom: 1px dashed #000;
                page-break-inside: avoid;
            }
            
            .copy-container:last-child {
                border-bottom: none;
            }
            
            /* Header Section */
            .header {
                text-align: center;
                border-bottom: 1px solid #000;
                padding-bottom: 2mm;
                margin-bottom: 2mm;
            }
            
            .company-name {
                font-size: 14px;
                font-weight: bold;
                margin-bottom: 1mm;
            }
            
            .company-address {
                font-size: 8px;
                margin-bottom: 0.5mm;
            }
            
            .company-gst {
                font-size: 8px;
                font-weight: bold;
            }
            
            /* Bill Info Section */
            .bill-info {
                display: flex;
                justify-content: space-between;
                margin-bottom: 2mm;
                font-size: 8px;
            }
            
            .bill-info-left, .bill-info-right {
                width: 48%;
            }
            
            .bill-number {
                font-size: 9px;
                font-weight: bold;
            }
            
            /* Customer Section */
            .customer-section {
                margin-bottom: 2mm;
                font-size: 8px;
                padding: 1mm;
                border: 1px solid #ccc;
                background: #f9f9f9;
            }
            
            /* Items Table - Larger font for better readability */
            .items-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 2mm;
                font-size: 8px; /* Increased from 6px */
            }
            
            .items-table th {
                background: #f0f0f0;
                padding: 1.5mm;
                border: 0.3px solid #000;
                font-weight: bold;
                text-align: center;
                font-size: 8px;
            }
            
            .items-table td {
                padding: 1.5mm;
                border: 0.3px solid #000;
                text-align: left;
                font-size: 8px;
            }
            
            .text-right { text-align: right; }
            .text-center { text-align: center; }
            
            /* Totals Section */
            .totals-section {
                border-top: 1px solid #000;
                padding-top: 2mm;
                margin-bottom: 2mm;
                font-size: 9px; /* Increased font size */
            }
            
            .total-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 1mm;
            }
            
            .grand-total {
                font-size: 11px; /* Larger grand total */
                font-weight: bold;
                border-top: 1px solid #000;
                padding-top: 1mm;
                margin-top: 1mm;
                display: flex;
                justify-content: space-between;
            }
            
            /* Footer */
            .footer {
                border-top: 1px solid #000;
                padding-top: 1mm;
                text-align: center;
                font-size: 7px;
                margin-top: 1mm;
            }
            
            .print-info {
                display: flex;
                justify-content: space-between;
                margin-top: 1mm;
                font-size: 7px;
            }
            
            /* Copy labels */
            .copy-label {
                text-align: center;
                font-size: 9px;
                font-weight: bold;
                margin-bottom: 1mm;
                color: #666;
            }
            
            /* Print-specific settings */
            @media print {
                body {
                    -webkit-print-color-adjust: exact;
                    print-color-adjust: exact;
                }
            }
    body
        //- FIRST COPY (TOP HALF)
        .copy-container
            .copy-label CUSTOMER COPY
            
            //- Header Section
            .header
                .company-name #{bill.location_name || 'Petrol Pump'}
                .company-address #{bill.location_address || 'Address not available'}
                if bill.location_phone
                    .company-address Phone: #{bill.location_phone}
                if bill.location_gst
                    .company-gst GST: #{bill.location_gst}
            
            //- Bill Information
            .bill-info
                .bill-info-left
                    .bill-number Bill: #{bill.bill_no}
                    div Type: #{bill.bill_type}
                    div Status: #{bill.bill_status}
                
                .bill-info-right
                    div Date: #{new Date(bill.creation_date).toLocaleDateString('en-IN')}
                    div Time: #{new Date(bill.creation_date).toLocaleTimeString('en-IN')}
                    div Print ##{bill.print_count + 1}
            
            //- Customer Section
            if bill.customer_name
                .customer-section
                    strong Customer: #{bill.customer_name}
                    if bill.cashier_name
                        br
                        | Cashier: #{bill.cashier_name}
            
            //- Items Table
            if items && items.length > 0
                table.items-table
                    thead
                        tr
                            th Product
                            th Qty
                            th Rate
                            th Disc
                            th Tax
                            th Total
                    tbody
                        each item in items
                            tr
                                td= item.product_name
                                td.text-right= parseFloat(item.qty).toFixed(2)
                                td.text-right ₹#{parseFloat(item.price).toFixed(2)}
                                td.text-right ₹#{parseFloat(item.discount || 0).toFixed(2)}
                                td.text-right ₹#{parseFloat((item.cgst_amount || 0) + (item.sgst_amount || 0)).toFixed(2)}
                                td.text-right ₹#{parseFloat(item.amount).toFixed(2)}
            
            //- Totals Section
            .totals-section
                if totals
                    .total-row
                        span Subtotal:
                        span ₹#{totals.subtotal.toFixed(2)}
                    .total-row
                        span CGST:
                        span ₹#{totals.cgst.toFixed(2)}
                    .total-row
                        span SGST:
                        span ₹#{totals.sgst.toFixed(2)}
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{totals.grandTotal.toFixed(2)}
                else
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{parseFloat(bill.total_amount || 0).toFixed(2)}
            
            //- Footer
            .footer
                div Thank you for your business!
                .print-info
                    span Printed: #{new Date().toLocaleDateString('en-IN')} #{new Date().toLocaleTimeString('en-IN')}
                    span Print Count: #{bill.print_count + 1}

        //- SECOND COPY (BOTTOM HALF) - IDENTICAL CONTENT
        .copy-container
            .copy-label OFFICE COPY
            
            //- Header Section
            .header
                .company-name #{bill.location_name || 'Petrol Pump'}
                .company-address #{bill.location_address || 'Address not available'}
                if bill.location_phone
                    .company-address Phone: #{bill.location_phone}
                if bill.location_gst
                    .company-gst GST: #{bill.location_gst}
            
            //- Bill Information
            .bill-info
                .bill-info-left
                    .bill-number Bill: #{bill.bill_no}
                    div Type: #{bill.bill_type}
                    div Status: #{bill.bill_status}
                
                .bill-info-right
                    div Date: #{new Date(bill.creation_date).toLocaleDateString('en-IN')}
                    div Time: #{new Date(bill.creation_date).toLocaleTimeString('en-IN')}
                    div Print ##{bill.print_count + 1}
            
            //- Customer Section
            if bill.customer_name
                .customer-section
                    strong Customer: #{bill.customer_name}
                    if bill.cashier_name
                        br
                        | Cashier: #{bill.cashier_name}
            
            //- Items Table
            if items && items.length > 0
                table.items-table
                    thead
                        tr
                            th Product
                            th Qty
                            th Rate
                            th Disc
                            th Tax
                            th Total
                    tbody
                        each item in items
                            tr
                                td= item.product_name
                                td.text-right= parseFloat(item.qty).toFixed(2)
                                td.text-right ₹#{parseFloat(item.price).toFixed(2)}
                                td.text-right ₹#{parseFloat(item.discount || 0).toFixed(2)}
                                td.text-right ₹#{parseFloat((item.cgst_amount || 0) + (item.sgst_amount || 0)).toFixed(2)}
                                td.text-right ₹#{parseFloat(item.amount).toFixed(2)}
            
            //- Totals Section
            .totals-section
                if totals
                    .total-row
                        span Subtotal:
                        span ₹#{totals.subtotal.toFixed(2)}
                    .total-row
                        span CGST:
                        span ₹#{totals.cgst.toFixed(2)}
                    .total-row
                        span SGST:
                        span ₹#{totals.sgst.toFixed(2)}
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{totals.grandTotal.toFixed(2)}
                else
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{parseFloat(bill.total_amount || 0).toFixed(2)}
            
            //- Footer
            .footer
                div Thank you for your business!
                .print-info
                    span Printed: #{new Date().toLocaleDateString('en-IN')} #{new Date().toLocaleTimeString('en-IN')}
                    span Print Count: #{bill.print_count + 1}

        //- Auto-print when page loads
        script.
            window.onload = function() {
                setTimeout(function() {
                    window.print();
                }, 500);
            };
            
            window.onafterprint = function() {
                window.close();
            };