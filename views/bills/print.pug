doctype html
html(lang='en')
    head
        meta(charset='UTF-8')
        meta(name='viewport', content='width=device-width, initial-scale=1.0')
        title Bill #{bill.bill_no} - Print
        style.
            /* A6 paper size: 105mm x 148mm */
            @page {
                size: A6;
                margin: 3mm;
            }
            
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Courier New', monospace;
                font-size: 9px;
                line-height: 1.2;
                width: 99mm; /* A6 width minus margins */
                margin: 0 auto;
                background: white;
                color: black;
                font-weight: bold; /* Make all text bold */
            }
            
            /* Container for each copy */
            .copy-container {
                width: 100%;
                height: 71mm; /* Half of A6 height minus margins */
                padding: 1.5mm;
                border-bottom: 1px dashed #000;
                page-break-inside: avoid;
            }
            
            .copy-container:last-child {
                border-bottom: none;
            }
            
            /* Header Section */
            .header {
                text-align: center;
                border-bottom: 1px solid #000;
                padding-bottom: 1.5mm;
                margin-bottom: 1.5mm;
            }
            
            .company-name {
                font-size: 13px;
                font-weight: bold;
                margin-bottom: 1mm;
            }
            
            .company-address {
                font-size: 7px;
                margin-bottom: 0.5mm;
                font-weight: bold;
            }
            
            .company-contact {
                font-size: 7px;
                font-weight: bold;
            }
            
            /* Bill Info Section - 3 columns */
            .bill-info {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 2mm;
                margin-bottom: 1.5mm;
                font-size: 8px;
                font-weight: bold;
            }
            
            .bill-info-col {
                display: flex;
                flex-direction: column;
            }
            
            .bill-number {
                font-size: 9px;
                font-weight: bold;
            }
            
            /* Customer Section - Combined with Cashier */
            .customer-section {
                margin-bottom: 1.5mm;
                font-size: 8px;
                padding: 1mm;
                border: 1px solid #ccc;
                background: #f9f9f9;
                font-weight: bold;
                display: flex;
                justify-content: space-between;
            }
            
            /* Items Table - Optimized for A6 */
            .items-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 1.5mm;
                font-size: 8px;
                font-weight: bold;
            }
            
            .items-table th {
                background: #f0f0f0;
                padding: 1mm;
                border: 0.2px solid #999;
                font-weight: bold;
                text-align: center;
                font-size: 8px;
            }
            
            .items-table td {
                padding: 1mm;
                border: 0.2px solid #ccc;
                text-align: left;
                font-size: 8px;
                font-weight: bold;
            }
            
            .text-right { text-align: right; }
            .text-center { text-align: center; }
            
            /* Totals Section */
            .totals-section {
                border-top: 1px solid #000;
                padding-top: 1.5mm;
                margin-bottom: 1.5mm;
                font-size: 9px;
                font-weight: bold;
            }
            
            .total-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 0.5mm;
            }
            
            .grand-total {
                font-size: 11px;
                font-weight: bold;
                border-top: 1px solid #000;
                padding-top: 1mm;
                margin-top: 1mm;
                display: flex;
                justify-content: space-between;
            }
            
            /* Footer - Signature lines */
            .footer {
                border-top: 1px solid #000;
                padding-top: 1mm;
                margin-top: 1mm;
                font-weight: bold;
            }
            
            .signature-section {
                display: flex;
                justify-content: space-between;
                margin-top: 2mm;
                font-size: 7px;
            }
            
            .signature-line {
                width: 45%;
            }
            
            /* Copy labels */
            .copy-label {
                text-align: center;
                font-size: 9px;
                font-weight: bold;
                margin-bottom: 1mm;
                color: #666;
            }
            
            /* Print-specific settings */
            @media print {
                body {
                    -webkit-print-color-adjust: exact;
                    print-color-adjust: exact;
                }
            }
    body
        //- FIRST COPY (TOP HALF)
        .copy-container
            .copy-label CUSTOMER COPY
            
            //- Header Section
            .header
                .company-name #{bill.location_name || 'Petrol Pump'}
                .company-address #{bill.location_address || 'Address not available'}
                .company-contact
                    if bill.location_gst
                        span GST: #{bill.location_gst}
                        span  | 
                    if bill.location_phone
                        span Phone: #{bill.location_phone}
            
            //- Bill Information (3 columns)
            .bill-info
                .bill-info-col
                    .bill-number Bill: #{bill.bill_no}
                .bill-info-col
                    div Type: #{bill.bill_type}
                .bill-info-col
                    div Date: #{new Date(bill.creation_date).toLocaleDateString('en-IN')}
            
            //- Customer and Cashier Section (same line)
            .customer-section
                if bill.customer_name
                    span Customer: #{bill.customer_name}
                if bill.vehicle_info
                    span Vehicle: #{bill.vehicle_info}
            
            //- Items Table
            if items && items.length > 0
                table.items-table
                    thead
                        tr
                            th Product
                            th Qty
                            th Rate
                            th Total
                    tbody
                        each item in items
                            tr
                                td= item.product_name
                                td.text-right= parseFloat(item.qty).toFixed(2)
                                td.text-right ₹#{parseFloat(item.price).toFixed(2)}
                                td.text-right ₹#{parseFloat(item.amount).toFixed(2)}
            
            //- Totals Section
            .totals-section
                if totals
                    .total-row
                        span Subtotal:
                        span ₹#{totals.subtotal.toFixed(2)}
                    .total-row
                        span CGST:
                        span ₹#{totals.cgst.toFixed(2)}
                    .total-row
                        span SGST:
                        span ₹#{totals.sgst.toFixed(2)}
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{totals.grandTotal.toFixed(2)}
                else
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{parseFloat(bill.total_amount || 0).toFixed(2)}
            
            //- Footer
            .footer
                div Thank you for your business!
                .signature-section
                    .signature-line Received by: __________
                    .signature-line Cashier: #{bill.cashier_name || '__________'}

        //- SECOND COPY (BOTTOM HALF) - IDENTICAL TO CUSTOMER COPY
        .copy-container
            .copy-label OFFICE COPY
            
            //- Header Section
            .header
                .company-name #{bill.location_name || 'Petrol Pump'}
                .company-address #{bill.location_address || 'Address not available'}
                .company-contact
                    if bill.location_gst
                        span GST: #{bill.location_gst}
                        span  | 
                    if bill.location_phone
                        span Phone: #{bill.location_phone}
            
            //- Bill Information (3 columns)
            .bill-info
                .bill-info-col
                    .bill-number Bill: #{bill.bill_no}
                .bill-info-col
                    div Type: #{bill.bill_type}
                .bill-info-col
                    div Date: #{new Date(bill.creation_date).toLocaleDateString('en-IN')}
            
            //- Customer and Cashier Section (same line)
            .customer-section
                if bill.customer_name
                    span Customer: #{bill.customer_name}
                if bill.vehicle_info
                    span Vehicle: #{bill.vehicle_info}
            
            //- Items Table
            if items && items.length > 0
                table.items-table
                    thead
                        tr
                            th Product
                            th Qty
                            th Rate
                            th Total
                    tbody
                        each item in items
                            tr
                                td= item.product_name
                                td.text-right= parseFloat(item.qty).toFixed(2)
                                td.text-right ₹#{parseFloat(item.price).toFixed(2)}
                                td.text-right ₹#{parseFloat(item.amount).toFixed(2)}
            
            //- Totals Section
            .totals-section
                if totals
                    .total-row
                        span Subtotal:
                        span ₹#{totals.subtotal.toFixed(2)}
                    .total-row
                        span CGST:
                        span ₹#{totals.cgst.toFixed(2)}
                    .total-row
                        span SGST:
                        span ₹#{totals.sgst.toFixed(2)}
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{totals.grandTotal.toFixed(2)}
                else
                    .grand-total
                        span GRAND TOTAL:
                        span ₹#{parseFloat(bill.total_amount || 0).toFixed(2)}
            
            //- Footer
            .footer
                div Thank you for your business!
                .signature-section
                    .signature-line Received by: __________
                    .signature-line Cashier: #{bill.cashier_name || '__________'}

        //- Auto-print when page loads
        script.
            window.onload = function() {
                setTimeout(function() {
                    window.print();
                }, 500);
            };
            
            window.onafterprint = function() {
                window.close();
            };